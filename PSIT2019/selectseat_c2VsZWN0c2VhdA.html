<!DOCTYPE html>
<html>
<head>
    <title>จองที่นั่ง | SELECT YOUR SEAT</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Kanit&display=swap" rel="stylesheet">
</head>

<style>
    body{
        background-image: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
        background-size: cover;
        background-repeat: repeat;
        background-attachment: fixed;
        font-family: 'Kanit', sans-serif;
      }
    .dot {
        height: 4vh;
        width: 4vh;
        background-color:#5cb85c;
        color: seashell;
        border-radius: 50%;
        margin: 0.2vh;
        display: inline-block;
      }
    .dot1 {
        height: 4vh;
        width: 4vh;
        background-color:#5cb85c;
        color: seashell;
        border-radius: 50%;
        margin: 0.2vh;
        display: inline-block;
      }
    .dot2 {
        height: 4vh;
        width: 4vh;
        background-color: #d9534f;
        color: seashell;
        border-radius: 50%;
        margin: 0.2vh;
        display: inline-block;
      }
    .dot > * {
        background-color: ;
    }
    .sqr {
        height: 5.5vh;
        width: 9vh;
        background-color: transparent;
        border: #6c757d;
        border-style: solid;
        border-width: 1px;
        border-radius: 5px;
        color:#343a40;
        margin-top: 0.8vh;
        margin-bottom: 0.8vh;
        display: inline-block;
      }
    .space {
        margin:5vh;
      }
    .obj-center{
        text-align: center;
        margin: auto;
        padding: 1vh;
      }
    .text {
        background-image: linear-gradient(transparent 0%, currentColor 30%, currentColor 70%, transparent 90%);
      -webkit-background-clip: text;
        background-clip: text;
        background-attachment: fixed;
      }
    .text > * {
        color: transparent;
      }
    .text-fgreen {
        color: #5cb85c;
        background-image: linear-gradient(transparent 0%, currentColor 30%, currentColor 70%, transparent 90%);
      -webkit-background-clip: text;
        background-clip: text;
        background-attachment: fixed;
      }
    .text-fgreen > * {
        color: transparent;
      }
    .text-fred {
        color: #d9534f;
        background-image: linear-gradient(transparent 0%, currentColor 30%, currentColor 70%, transparent 90%);
      -webkit-background-clip: text;
        background-clip: text;
        background-attachment: fixed;
      }
    .text-fred > * {
        color: transparent;
      }
</style>

<body>
  <script>
    window.addEventListener( "pageshow", function ( event ) {
    var historyTraversal = event.persisted ||
                         ( typeof window.performance != "undefined" &&
                              window.performance.navigation.type === 2 );
  if ( historyTraversal ) {
    // Handle page restore.
    window.location.reload();
  }
});
  </script>
    <!-- Navbar menu !-->
          <div class="row">
              <div class="col-md-12">
                <nav class="navbar navbar-expand-sm bg-transparent navbar-light">
                  <!-- Brand/logo -->
                  <a class="navbar-brand" href="#"><img src="icon/table.png" style="width: 10%"></a>
                  <ul class="navbar-nav mr-auto mt-2 mt-lg-0"></ul>
                  <!-- Get user time -->
                  <ul class="navbar-nav justify-content-end my-sm-0">
                    <form class="form-inline my-3 my-lg-0">
                        <label>Search your seat &nbsp</label>
                        <input type="Phone Number" class="form-control mr-sm-2" id="phonelogin" placeholder="Phone Number">
                        <a href="" class="btn btn-outline-primary my-2 my-sm-0" id="check">Submit</a>
                    </form>
                  </ul>
                </nav>
              </div>
          </div>

    <!--Jumbotron-->
        <div class="row">
          <div class="col-md-12 text-center" style="padding-top: 7vh; padding-bottom: 10vh;">
            <div class="text">
              <h1>ที่นั่งโซนอาหาร</h1>
            </div>
            <div class="row">
              <div class="col-md-2 col-2"></div>
              <div class="col-md-4 col-4 text-fgreen">
                <span class="dot1"></span><h6>ที่นั่งว่าง</h6>
              </div>
              <div class="col-md-4 col-4 text-fred">
              <span class="dot2"></span><h6>ที่นั่งไม่ว่าง</h6>
              </div>
              <div class="col-md-2 col-2"></div>
            </div>
          </div>
        </div>

        <!-- Table Preview!-->
        <div class="container">
        <div class="row" style="text-align: center;">

          <!-- Table Row A-->
          <div class="col-3">
            <div class="row">
              <div class="obj-center">
              <span class="dot" id="A11">1</span>
              <span class="dot" id="A12">2</span>
              </div>
            </div>
              <span class="sqr obj-center">A1</span>
            <div class="row">
              <div class="obj-center">
              <span class="dot" id="A13">3</span>
              <span class="dot" id="A14">4</span>
              </div>
            </div>

            <div class="space"></div>

            <div class="row">
              <div class="obj-center">
              <span class="dot" id="A21">1</span>
              <span class="dot" id="A22">2</span>
              </div>
            </div>
              <span class="sqr obj-center">A2</span>
            <div class="row">
              <div class="obj-center">
              <span class="dot" id="A23">3</span>
              <span class="dot" id="A24">4</span>
              </div>
            </div>

            <div class="space"></div>

            <div class="row">
              <div class="obj-center">
              <span class="dot" id="A31">1</span>
              <span class="dot" id="A32">2</span>
              </div>
            </div>
              <span class="sqr obj-center">A3</span>
            <div class="row">
              <div class="obj-center">
              <span class="dot" id="A33">3</span>
              <span class="dot" id="A34">4</span>
              </div>
            </div>
          </div>

          <!-- Table Row ฺฺB-->
          <div class="col-3">
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="B11">1</span>
                <span class="dot" id="B12">2</span>
                </div>
              </div>
                <span class="sqr obj-center">B1</span>
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="B13">3</span>
                <span class="dot" id="B14">4</span>
                </div>
              </div>

              <div class="space"></div>

              <div class="row">
                <div class="obj-center">
                <span class="dot" id="B21">1</span>
                <span class="dot" id="B22">2</span>
                </div>
              </div>
                <span class="sqr obj-center">B2</span>
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="B23">3</span>
                <span class="dot" id="B24">4</span>
                </div>
              </div>


              <div class="space"></div>

              <div class="row">
                <div class="obj-center">
                <span class="dot" id="B31">1</span>
                <span class="dot" id="B32">2</span>
                </div>
              </div>
                <span class="sqr obj-center">B3</span>
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="B33">3</span>
                <span class="dot" id="B34">4</span>
                </div>
              </div>
          </div>

          <!-- Table Row C-->
          <div class="col-3">
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="C11">1</span>
                <span class="dot" id="C12">2</span>
                </div>
              </div>
                <span class="sqr obj-center">C1</span>
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="C13">3</span>
                <span class="dot" id="C14">4</span>
                </div>
              </div>

              <div class="space"></div>

              <div class="row">
                <div class="obj-center">
                <span class="dot" id="C21">1</span>
                <span class="dot" id="C22">2</span>
                </div>
              </div>
                <span class="sqr obj-center">C2</span>
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="C23">3</span>
                <span class="dot" id="C24">4</span>
                </div>
              </div>


              <div class="space"></div>

              <div class="row">
                <div class="obj-center">
                <span class="dot" id="C31">1</span>
                <span class="dot" id="C32">2</span>
                </div>
              </div>
                <span class="sqr obj-center">C3</span>
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="C33">3</span>
                <span class="dot" id="C34">4</span>
                </div>
              </div>
          </div>

          <!-- Table Row D-->
          <div class="col-3">
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="D11">1</span>
                <span class="dot" id="D12">2</span>
                </div>
              </div>
                <span class="sqr obj-center">D1</span>
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="D13">3</span>
                <span class="dot" id="D14">4</span>
                </div>
              </div>

              <div class="space"></div>

              <div class="row">
                <div class="obj-center">
                <span class="dot" id="D21">1</span>
                <span class="dot" id="D22">2</span>
                </div>
              </div>
                <span class="sqr obj-center">D2</span>
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="D23">3</span>
                <span class="dot" id="D24">4</span>
                </div>
              </div>

              <div class="space"></div>

              <div class="row">
                <div class="obj-center">
                <span class="dot" id="D31">1</span>
                <span class="dot" id="D32">2</span>
                </div>
              </div>
                <span class="sqr obj-center">D3</span>
              <div class="row">
                <div class="obj-center">
                <span class="dot" id="D33">3</span>
                <span class="dot" id="D34">4</span>
                </div>
              </div>
          </div>
        </div>

          </div>
        </div>
        <br><br><br>

        <!-- Sign up for reserve-->
        <div class="container">
          <div class="col-12">
              <div class="card" style="background-color: transparent;">
                  <div class="card-body">
                    <form action="" method="post" enctype="multipart/form-data" onSubmit="JavaScript:return fncSubmit();">
                          <div class="form-row">
                            <div class="col-12 col-md-6">
                                <label>First Name</label>
                                <input type="firstname" class="form-control" id="firstname" placeholder="First Name">
                            </div>
                            <div class="col-md-6 col-12">
                                <label>Last Name</label>
                                <input type="lastname" class="form-control" id="lastname" placeholder="Last Name">
                            </div>
                          </div>
                          <div class="form-row">
                            <div class="col-12 col-md-6">
                                <label>Phone Number</label>
                                <input type="text" class="form-control" id="phone" placeholder="0xxxxxxxxx">
                            </div>
                            <div class="col-md-6 col-12">
                                <label>Time</label>
                                <select class="form-control form-control" id="hour">
                                  <option value="1">1 hr</option>
                                  <option value="2">2 hr</option>
                                  <option value="3">3 hr</option>
                                </select>
                            </div>
                          </div>
                          <div class="form-row">
                              <div class="col-12 col-md-6">
                                  <label>Table</label>
                                  <select class="form-control form-control" id="table" onchange="dosomething()">
                                    <option disabled selected value="t0"> -- Select table -- </option>
                                    <option id="ta1" value="A1">A1</option>
                                    <option id="ta2" value="A2">A2</option>
                                    <option id="ta3" value="A3">A3</option>
                                    <option id="tb1" value="B1">B1</option>
                                    <option id="tb2" value="B2">B2</option>
                                    <option id="tb3" value="B3">B3</option>
                                    <option id="tc1" value="C1">C1</option>
                                    <option id="tc2" value="C2">C2</option>
                                    <option id="tc3" value="C3">C3</option>
                                    <option id="td1" value="D1">D1</option>
                                    <option id="td2" value="D2">D2</option>
                                    <option id="td3" value="D3">D3</option>
                                  </select>
                              </div>
                              <div class="col-md-6 col-12">
                                  <label>Seat</label>
                                  <select class="form-control form-control" id="seat">
                                    <option disabled selected value="s0"> -- Select a seat -- </option>
                                    <option disabled id="s1">1</option>
                                    <option disabled id="s2">2</option>
                                    <option disabled id="s3">3</option>
                                    <option disabled id="s4">4</option>
                                  </select>
                              </div>
                            </div>
                            <br>
                          <a onclick="return follow();" href="" class="btn btn-primary" id="submit">Submit</a>
                        </div>
                      </div>
                    </form>
                  </div>
              </div>
          </div>
        </div>

  <!-- Footer -->
  <br><br>
    <footer class="footer text-center">
      <p>Problem Solving in Information Technology 2019</p>
    </footer>
  <!-- Footer -->
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.5.2/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyApl3QXQZ32x75rxGbfPfUG0DKW6JRSqnQ",
    authDomain: "psit2019-t1.firebaseapp.com",
    databaseURL: "https://psit2019-t1.firebaseio.com",
    projectId: "psit2019-t1",
    storageBucket: "psit2019-t1.appspot.com",
    messagingSenderId: "412001566845",
    appId: "1:412001566845:web:d6ff242f423865da77f114",
    measurementId: "G-M10FK23Q84"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>
<script>
  //function : change color of seat when that seat is booked and time's up.
  function checking(seat) {
      if (seat == 0)  {
        return "#d9534f";
      } else {
        return "#5cb85c"
      }
    }

  let myFirebase = firebase.database();
  let dataRef = myFirebase.ref('/listofuser');
  let dataseat = myFirebase.ref('tableandseat/table');
  let datalist = [];
  dataRef.on("value", function(snapshot){
    snapshot.forEach(function(child){
      datalist.push(child.val()['phone'])
    });
  });
  //change color of seat when that seat is booked and time's up.
  dataseat.limitToLast(100).on("value", function(childSnapshot) {
    let item = childSnapshot.val();
    var word = ["A", "B", "C", "D"];
    word.forEach(element => {
      for (var i = 1; i < 4; i++) {
        for (var j = 1; j < 5; j++) {
          let x = element+i+j;
          document.getElementById(x).style.backgroundColor = checking(eval("item."+x));
            }
          }
        });
      });
  //call function checking when data is changed.
    dataseat.on("child_changed", function(snapshot){
        let aaaa = snapshot.key
           document.getElementById(aaaa).style.backgroundColor = checking(snapshot.val());
      });

//send data to firebase
  document.getElementById("submit").onclick = function() {
    let x = new Date();
    let hoursce = document.getElementById("hour");
    let strhour = hoursce.options[hoursce.selectedIndex].value;
    let inthour = parseInt(strhour, 10);
    let lfirstname = document.getElementById("firstname").value;
    let llastname = document.getElementById("lastname").value;
    let lphone = document.getElementById("phone").value;
    let tablesce = document.getElementById("table");
    let strtable = tablesce.options[tablesce.selectedIndex].text;
    let seatsce = document.getElementById("seat");
    let strseat = seatsce.options[seatsce.selectedIndex].text;
    let nhour = x.getHours();
    let nminute = x.getMinutes();
    let lnow = x.getTime();
    let idtable = strtable + strseat
    //check user fill out all of form.
    if (datalist.includes(lphone)) {
      alert("Your phone number is already used.");
      return false;
    }
    if(document.getElementById('firstname').value == "")
    {
        alert('Please input your name');
        return false;
    }
    if(document.getElementById('lastname').value == "")
    {
        alert('Please input your lastname');
        return false;
    }
    if(document.getElementById('phone').value == "")
    {
        alert('Please input your phone number');
        return false;
    }
    if(document.getElementById("table").value == document.getElementById("table")[0].value)
    {
        alert('Please choose your table again');
        return false;
    }
    if(document.getElementById("seat").value == document.getElementById("seat")[0].value)
    {
        alert('Please choose your seat again');
        return false;
    } else {
      document.getElementById('submit').href = "timer.html?" + lphone;
    }
    //send data to firebase
    dataRef.push({
      firstname: lfirstname,
      lastname: llastname,
      phone: lphone,
      want_hour: inthour,
      table: strtable,
      seat: strseat,
      hour: nhour,
      miunte: nminute,
      now: lnow
    });
    //update firebase that seat is booked.
    dataseat.update({
      [idtable]: 0
    })
  };
  //use phone number for check time.
  document.getElementById("check").onclick = function(){
    let num = document.getElementById("phonelogin").value;
    document.getElementById("check").href = "timer.html?" + num;
  };

  //disallow to book that seat.
  function dosomething() {
    document.getElementById("seat")[0].selected = true;
    dataseat.on("value", function(snapshot){
      value_snapshot = snapshot.val();
      value = document.getElementById("table").value;
      valuelist = []
      for (var v = 1; v <= 4; ++v){
        valuelist[v] = value + v;
        if (value_snapshot[valuelist[v]] == 0){
          document.getElementById("s"+v)  .disabled = true;
        } else {
          document.getElementById("s"+v).disabled = false;
        }
      }
    });
  };
</script>

</body>
</html>

